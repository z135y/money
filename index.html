<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>ğŸµ èŒ¶è‘‰å±•å”® POS ç³»çµ±</title>
    <style>
        /* --- POS å°ˆç”¨ä»‹é¢è¨­è¨ˆ --- */
        body { font-family: -apple-system, BlinkMacSystemFont, "Microsoft JhengHei", sans-serif; margin: 0; background-color: #f2f2f7; display: flex; height: 100vh; overflow: hidden; }
        
        /* å·¦å´ï¼šå•†å“å€ (70%) */
        .product-area { flex: 7; padding: 15px; overflow-y: auto; display: grid; grid-template-columns: repeat(auto-fill, minmax(140px, 1fr)); gap: 15px; align-content: start; }
        
        /* å•†å“å¡ç‰‡ */
        .product-card { background: white; border-radius: 12px; padding: 15px; text-align: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05); cursor: pointer; transition: 0.1s; border: 2px solid transparent; user-select: none; }
        .product-card:active { transform: scale(0.95); border-color: #27ae60; background: #e8f8f5; }
        .p-name { font-weight: bold; font-size: 16px; color: #2c3e50; margin-bottom: 5px; }
        .p-price { color: #e67e22; font-weight: bold; font-size: 14px; }
        
        /* é¡è‰²æ¨™ç±¤ (å€åˆ†èŒ¶ç¨®) */
        .tag { display: inline-block; width: 10px; height: 10px; border-radius: 50%; margin-bottom: 5px; }
        
        /* å³å´ï¼šçµå¸³å€ (30%) */
        .sidebar { flex: 3; background: white; display: flex; flex-direction: column; border-left: 1px solid #ddd; box-shadow: -5px 0 15px rgba(0,0,0,0.05); min-width: 300px; }
        
        .cart-header { padding: 15px; background: #2c3e50; color: white; font-weight: bold; text-align: center; font-size: 18px; }
        
        /* è³¼ç‰©è»Šæ¸…å–® */
        .cart-list { flex: 1; overflow-y: auto; padding: 10px; }
        .cart-item { display: flex; justify-content: space-between; align-items: center; padding: 10px; border-bottom: 1px solid #eee; animation: slideIn 0.2s; }
        .item-info { flex: 1; }
        .item-name { font-size: 14px; font-weight: bold; display: block; }
        .item-price { font-size: 12px; color: #888; }
        .item-qty { font-weight: bold; color: #27ae60; background: #e8f8f5; padding: 2px 8px; border-radius: 10px; font-size: 14px; }
        .btn-del { color: #e74c3c; cursor: pointer; padding: 5px; font-size: 18px; margin-left: 10px; }

        /* çµå¸³å€å¡Š */
        .checkout-section { padding: 20px; background: #f8f9fa; border-top: 1px solid #ddd; }
        .total-row { display: flex; justify-content: space-between; font-size: 24px; font-weight: 800; color: #2c3e50; margin-bottom: 15px; }
        
        .payment-methods { display: flex; gap: 10px; margin-bottom: 15px; }
        .pay-btn { flex: 1; padding: 10px; border: 1px solid #ddd; border-radius: 8px; cursor: pointer; text-align: center; font-weight: bold; color: #555; background: white; }
        .pay-btn.active { background: #2c3e50; color: white; border-color: #2c3e50; }

        .btn-checkout { width: 100%; padding: 15px; background: #27ae60; color: white; border: none; border-radius: 8px; font-size: 20px; font-weight: bold; cursor: pointer; transition: 0.2s; }
        .btn-checkout:active { transform: scale(0.98); background: #219150; }
        .btn-checkout:disabled { background: #95a5a6; cursor: not-allowed; }

        .btn-clear { width: 100%; margin-top: 10px; padding: 10px; background: transparent; border: 1px solid #e74c3c; color: #e74c3c; border-radius: 8px; cursor: pointer; }

        @keyframes slideIn { from { opacity: 0; transform: translateX(20px); } to { opacity: 1; transform: translateX(0); } }
        
        /* æ‰‹æ©Ÿç‰ˆå„ªåŒ– */
        @media (max-width: 768px) {
            body { flex-direction: column; }
            .product-area { flex: 1.5; padding: 10px; gap: 10px; }
            .sidebar { flex: 1; min-height: 40%; border-left: none; border-top: 1px solid #ddd; }
            .product-card { padding: 10px; }
        }
    </style>
</head>
<body>

<div class="product-area" id="productGrid">
    </div>

<div class="sidebar">
    <div class="cart-header">ğŸ›’ è³¼ç‰©è»Š (Cart)</div>
    
    <div class="cart-list" id="cartList">
        <div style="text-align:center; color:#999; margin-top:50px;">å°šæœªé¸æ“‡å•†å“</div>
    </div>

    <div class="checkout-section">
        <div class="total-row">
            <span>Total</span>
            <span id="totalAmount">$0</span>
        </div>

        <div class="payment-methods">
            <div class="pay-btn active" onclick="setMethod(this, 'ç¾é‡‘')">ğŸ’µ ç¾é‡‘</div>
            <div class="pay-btn" onclick="setMethod(this, 'LinePay')">ğŸ“² LinePay</div>
            <div class="pay-btn" onclick="setMethod(this, 'ä¿¡ç”¨å¡')">ğŸ’³ åˆ·å¡</div>
        </div>

        <button class="btn-checkout" id="btnCheckout" onclick="submitOrder()">çµå¸³æ”¶æ¬¾</button>
        <button class="btn-clear" onclick="clearCart()">æ¸…ç©ºé‡ä¾†</button>
    </div>
</div>

<script>
    // ==========================================
    // âš ï¸ è«‹åœ¨æ­¤å¡«å…¥æ‚¨çš„ Google Apps Script ç¶²å€
    // ==========================================
    const GOOGLE_SCRIPT_URL = "æ‚¨çš„_POS_SCRIPT_URL_è²¼åœ¨é€™è£¡"; 
    // ==========================================

    // 1. å•†å“è³‡æ–™åº« (è«‹åœ¨æ­¤è¨­å®šæ‚¨çš„åƒ¹æ ¼)
    const products = [
        { id: 1, name: 'æ–‡å±±åŒ…ç¨®èŒ¶', price: 250, color: '#27ae60' },
        { id: 2, name: 'èœœé¦™ç´…èŒ¶', price: 300, color: '#e74c3c' },
        { id: 3, name: 'ç´…çƒé¾', price: 450, color: '#d35400' },
        { id: 4, name: 'å‡é ‚çƒé¾', price: 350, color: '#f1c40f' },
        { id: 5, name: 'èŒ¶å±±æ¼«éŠç¦®ç›’', price: 880, color: '#8e44ad' },
        { id: 6, name: 'ç›’è£èŒ¶åŒ…(10å…¥)', price: 90, color: '#3498db' },
        { id: 7, name: 'å†·æ³¡èŒ¶ (æ¯)', price: 60, color: '#1abc9c' },
        { id: 8, name: 'æè¢‹/åŒ…æ', price: 10, color: '#95a5a6' }
    ];

    let cart = {}; // è³¼ç‰©è»Šè³‡æ–™
    let currentMethod = 'ç¾é‡‘';

    // åˆå§‹åŒ–
    window.onload = function() {
        renderProducts();
    };

    // æ¸²æŸ“å•†å“æŒ‰éˆ•
    function renderProducts() {
        const grid = document.getElementById('productGrid');
        grid.innerHTML = products.map(p => `
            <div class="product-card" onclick="addToCart(${p.id})">
                <span class="tag" style="background:${p.color}"></span>
                <div class="p-name">${p.name}</div>
                <div class="p-price">$${p.price}</div>
            </div>
        `).join('');
    }

    // åŠ å…¥è³¼ç‰©è»Š
    function addToCart(id) {
        const product = products.find(p => p.id === id);
        if (cart[id]) {
            cart[id].qty += 1;
        } else {
            cart[id] = { ...product, qty: 1 };
        }
        updateCartUI();
    }

    // ç§»é™¤å•†å“
    function removeFromCart(id) {
        if (cart[id]) {
            cart[id].qty -= 1;
            if (cart[id].qty <= 0) delete cart[id];
        }
        updateCartUI();
    }

    // æ›´æ–°ä»‹é¢èˆ‡ç¸½é‡‘é¡
    function updateCartUI() {
        const list = document.getElementById('cartList');
        const totalEl = document.getElementById('totalAmount');
        let total = 0;
        let html = '';

        const items = Object.values(cart);

        if (items.length === 0) {
            list.innerHTML = '<div style="text-align:center; color:#999; margin-top:50px;">å°šæœªé¸æ“‡å•†å“</div>';
            totalEl.innerText = '$0';
            return;
        }

        items.forEach(item => {
            const subtotal = item.price * item.qty;
            total += subtotal;
            html += `
                <div class="cart-item">
                    <div class="item-info">
                        <span class="item-name">${item.name}</span>
                        <span class="item-price">$${item.price} x ${item.qty}</span>
                    </div>
                    <span class="item-qty">$${subtotal}</span>
                    <div class="btn-del" onclick="removeFromCart(${item.id})">âœ–</div>
                </div>
            `;
        });

        list.innerHTML = html;
        totalEl.innerText = '$' + total;
        
        // è‡ªå‹•æ²å‹•åˆ°åº•éƒ¨
        list.scrollTop = list.scrollHeight;
    }

    // è¨­å®šä»˜æ¬¾æ–¹å¼
    function setMethod(btn, method) {
        document.querySelectorAll('.pay-btn').forEach(b => b.classList.remove('active'));
        btn.classList.add('active');
        currentMethod = method;
    }

    // æ¸…ç©ºè³¼ç‰©è»Š
    function clearCart() {
        cart = {};
        updateCartUI();
    }

    // çµå¸³é€å‡º
    function submitOrder() {
        const items = Object.values(cart);
        if (items.length === 0) { alert("è³¼ç‰©è»Šæ˜¯ç©ºçš„ï¼"); return; }

        if(GOOGLE_SCRIPT_URL === "æ‚¨çš„_POS_SCRIPT_URL_è²¼åœ¨é€™è£¡") {
            alert("âš ï¸ è«‹å…ˆè¨­å®š Script ç¶²å€ï¼"); return;
        }

        const btn = document.getElementById('btnCheckout');
        const originalText = btn.innerText;
        btn.disabled = true;
        btn.innerText = "è™•ç†ä¸­...";

        // è¨ˆç®—ç¸½é‡‘é¡
        const total = items.reduce((sum, item) => sum + (item.price * item.qty), 0);
        
        // è£½ä½œæ˜ç´°å­—ä¸² (ä¾‹å¦‚: ç´…çƒé¾x2, èŒ¶åŒ…x1)
        const itemsString = items.map(i => `${i.name}x${i.qty}`).join(', ');

        const data = {
            items: itemsString,
            total: total,
            method: currentMethod,
            note: ''
        };

        fetch(GOOGLE_SCRIPT_URL, {
            method: "POST",
            mode: "no-cors",
            headers: { "Content-Type": "application/json" },
            body: JSON.stringify(data)
        })
        .then(() => {
            // æˆåŠŸå¾Œçš„å‹•ä½œ
            alert(`âœ… çµå¸³å®Œæˆï¼\né‡‘é¡ï¼š$${total}\næ–¹å¼ï¼š${currentMethod}`);
            clearCart();
            btn.disabled = false;
            btn.innerText = originalText;
        })
        .catch(err => {
            alert("âŒ é€£ç·šéŒ¯èª¤ï¼š" + err);
            btn.disabled = false;
            btn.innerText = originalText;
        });
    }
</script>

</body>
</html>